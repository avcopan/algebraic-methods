\documentclass[11pt,fleqn]{article}
\usepackage[cm]{fullpage}
%%AVC PACKAGES
\usepackage{avcgreek}
\usepackage{avcfonts}
\usepackage{avcmath}
\usepackage[numberby=section]{avcthm} % 
\usepackage{qcmacros}
\usepackage{goldstone}
%%MACROS FOR THIS DOCUMENT
\numberwithin{equation}{section}
\usepackage{titlesec}
\titleformat{\section}{\Large\bfseries\mathversion{bold}}{\thesection.}{5pt}{}
% remove header from TOC
\makeatletter
\renewcommand\tableofcontents{%
  \@starttoc{toc}%
}
\makeatother

%%%DOCUMENT%%%
\begin{document}


\section{Diagram notation}

\begin{ntt}\label{ntt:diagram-notation}
\thmtitle{Diagram notation}
In diagram notation, particle-hole operators are written as oriented lines extending from a vertex.
Particle annihilation operators enter the vertex from below, particle creation operators leave the vertex at the top, and single-excitation operators have both creation and annihilation lines.
Contractions are represented by joining particle-hole lines with compatible position and orientation.
\begin{align*}
&&
\diagram{
  \node[dot=white] (p) at (0,0) {};
  \draw[-<-] (p) to ++(0,-0.5);
}
\equiv
  a_p
&&
\diagram{
  \node[dot=white] (p) at (0,0) {};
  \draw[->-] (p) to ++(0,+0.5);
}
\equiv
  a_p^\dagger
&&
\diagram{
  \node[dot=white] (a) at (0,0) {};
  \draw[->-] (a) to ++(0,+0.5);
  \draw[-<-] (a) to ++(0,-0.5);
}
\equiv
  a_p\dg a_q
=
  a^p_q
&&
\diagram{
  \node[dot=white] (p) at (0,+0.5) {};
  \node[dot=white] (q) at (0,-0.5) {};
  \draw[->-] (q) to (p);
}
\equiv
  \ctr{}{a}{_p}{a} a_p a_q\dg
=
  a^{p^\ptcl}_{q^\ptcl}
\end{align*}
Quasiparticle operators with respect to $\F$ are distinguished by the use of closed-circle vertices, with particle lines pointing upward and with hole lines pointing downward.
Single-excitation operators split into four cases (vv, vo, ov, and oo) representing the virtual and occupied blocks of $a^p_q$.
Internal contractions of single-excitation operators (\textit{bubble contractions}) are implicitly taken to be hole contractions with respect to $\F$.
\begin{gather}
\begin{flalign*}
\diagram{
  \node[dot] (a) at (0,0) {};
  \draw[-<-] (a) to ++(0,-0.5);
}
\equiv
  b_a
&&
\diagram{
  \node[dot] (a) at (0,0) {};
  \draw[->-] (a) to ++(0,+0.5);
}
\equiv
  b_a^\dagger
&&
\diagram{
  \node[dot] (i) at (0,0) {};
  \draw[->-] (i) to ++(0,-0.5);
}
\equiv
  b_i
&&
\diagram{
  \node[dot] (i) at (0,0) {};
  \draw[-<-] (i) to ++(0,+0.5);
}
\equiv
  b_i^\dagger
&&
\diagram{
  \node[dot] (a) at (0,+0.5) {};
  \node[dot] (b) at (0,-0.5) {};
  \draw[->-] (b) to (a);
}
\equiv
  \ctr{}{b}{_a}{b}  b_ab_b\dg
=
  a^{a^\ptcl}_{b^\ptcl}
&&
\diagram{
  \node[dot] (i) at (0,+0.5) {};
  \node[dot] (j) at (0,-0.5) {};
  \draw[-<-] (j) to (i);
}
\equiv
  \ctr{}{b}{_i}{b}  b_ib_j\dg
=
  a^{i^\hole}_{j^\hole}
&&
\end{flalign*}\\
\begin{flalign*}
\diagram{
  \node[dot] (ab) at (0,0) {};
  \draw[->-] (ab) to ++(0,+0.5);
  \draw[-<-] (ab) to ++(0,-0.5);
}
\equiv
  b_a\dg b_b
=
  a^a_b
&&
\diagram{
  \node[dot] (ai) at (0,0) {};
  \draw[->-] (ai) to ++(-0.25,+0.5);
  \draw[-<-] (ai) to ++(+0.25,+0.5);
}
\equiv
  b_a\dg b_i\dg
=
  a^a_i
&&
\diagram{
  \node[dot] (ia) at (0,0) {};
  \draw[->-] (ia) to ++(-0.25,-0.5);
  \draw[-<-] (ia) to ++(+0.25,-0.5);
}
\equiv
  b_ib_a
=
  a^i_a
&&
\diagram{
  \node[dot] (ij) at (0,0) {};
  \draw[-<-] (ij) to ++(0,+0.5);
  \draw[->-] (ij) to ++(0,-0.5);
}
\equiv
  b_ib_j\dg 
=
  a^i_j
&&
\diagram{
  \node[dot] (pq) at (0,0) {};
  \draw[->-] (pq) arc (0:360:+0.3) {};
}
\equiv
  \ctr{}{b}{_i}{b}  b_ib_j\dg
=
  a^{i^\hole}_{j^\hole}
&&
\end{flalign*}
\end{gather}
Higher excitation operators are depicted by joining single-excitation operators with a solid line.
Contracted operators are implicitly normal ordered together.
Normal-ordered products of uncontracted operators are joined with a dotted line.
\begin{align*}
&&
\diagram{
  \node[dot=white] (a1) at (1,0) {};
  \node (dots) at (1.6,0) {$\cdots$};
  \node[dot=white] (an) at (2.2,0) {};
  \draw (a1)--(dots)--(an);
  \draw[->-] (a1) to ++(0,+0.5);
  \draw[->-] (an) to ++(0,+0.5);
  \draw[-<-] (a1) to ++(0,-0.5) coordinate[below left=0.1cm and 0.1cm] (startbrace);
  \draw[-<-] (an) to ++(0,-0.5) coordinate[below right=0.1cm and 0.1cm] (endbrace);
  \draw[decorate,decoration={brace,mirror}] (startbrace) to node[midway,below=0.1cm] () {\scriptsize{$m$ times}} (endbrace);
}
\equiv
  \no{a^{p_1}_{q_1}\cd a^{p_m}_{q_m}}
=
  a^{p_1\cd p_m}_{q_1\cd q_m}
&&
\diagram{
% first excitation operator
  \node[dot=white] (a1) at (1,0.5) {};
  \node (dots) at (1.6,0.5) {$\cdots$};
  \node[dot=white] (an) at (2.2,0.5) {};
  \draw (a1)--(dots)--(an);
  \draw[->-] (a1) to ++(0,+0.5) coordinate[above left=0.1cm and 0.1cm] (startbrace);
  \draw[->-] (an) to ++(0,+0.5) coordinate[above right=0.1cm and 0.1cm] (endbrace);
  \draw[-<-] (a1) to ++(0,-0.5);
  \draw[decorate,decoration={brace}] (startbrace) to node[midway,above=0.1cm] () {\scriptsize{$m$ times}} (endbrace);
% second excitation operator
  \node[dot=white] (b1) at (2.2,-0.5) {};
  \node (dots2) at (2.8,-0.5) {$\cdots$};
  \node[dot=white] (bn) at (3.4,-0.5) {};
  \draw (b1)--(dots2)--(bn);
  \draw[->-] (bn) to ++(0,+0.5);
  \draw[-<-] (b1) to ++(0,-0.5) coordinate[below left=0.1cm and 0.1cm] (startbrace2);
  \draw[-<-] (bn) to ++(0,-0.5) coordinate[below right=0.1cm and 0.1cm] (endbrace2);
  \draw[decorate,decoration={brace,mirror}] (startbrace2) to node[midway,below=0.1cm] () {\scriptsize{$n$ times}} (endbrace2);
% connecting line
  \draw[->-] (b1)--(an);
}
\equiv
  \no{a^{p_1\cd p_m}_{q_1\cd q_m^\ptcl}a^{r_1^\ptcl\cd r_n}_{s_1\cd s_n}}
&&
\diagram{
% first excitation operator
  \node[dot=white] (a1) at (1,0) {};
  \node (dots) at (1.6,0) {$\cdots$};
  \node[dot=white] (an) at (2.2,0) {};
  \draw (a1)--(dots)--(an);
  \draw[->-] (a1) to ++(0,+0.5);
  \draw[->-] (an) to ++(0,+0.5);
  \draw[-<-] (a1) to ++(0,-0.5) coordinate[below left=0.1cm and 0.1cm] (startbrace);
  \draw[-<-] (an) to ++(0,-0.5) coordinate[below right=0.1cm and 0.1cm] (endbrace);
  \draw[decorate,decoration={brace,mirror}] (startbrace) to node[midway,below=0.1cm] () {\scriptsize{$m$ times}} (endbrace);
% second excitation operator
  \node[dot=white] (b1) at (3,0) {};
  \node (dots2) at (3.6,0) {$\cdots$};
  \node[dot=white] (bn) at (4.2,0) {};
  \draw (b1)--(dots2)--(bn);
  \draw[->-] (b1) to ++(0,+0.5);
  \draw[->-] (bn) to ++(0,+0.5);
  \draw[-<-] (b1) to ++(0,-0.5) coordinate[below left=0.1cm and 0.1cm] (startbrace2);
  \draw[-<-] (bn) to ++(0,-0.5) coordinate[below right=0.1cm and 0.1cm] (endbrace2);
  \draw[decorate,decoration={brace,mirror}] (startbrace2) to node[midway,below=0.1cm] () {\scriptsize{$n$ times}} (endbrace2);
% connecting line
  \draw[densely dotted] (an)--(b1);
}
\equiv
  \no{a^{p_1\cd p_m}_{q_1\cd q_m}a^{r_1\cd r_n}_{s_1\cd s_n}}
\end{align*}
$\F$-normal-ordering is indicated by the use of double-circle vertices, $\diagram{\node[ddot=white] {};}$ and $\diagram{\node[ddot] {};}$ instead of $\diagram{\node[dot=white] {};}$ and $\diagram{\node[dot] {};}$.
\end{ntt}

\begin{dfn}\label{dfn:operators-in-diagram-notation}
\thmtitle{$m$-electron operators in diagram notation}
The primary building blocks of a graph are $m$-electron operators, which can be represented in two equivalent ways.
The \textit{Goldstone representation} depicts an operator as a label attached to the corresponding excitation operator, whereas the \textit{Hugenholtz representation} depicts the operator as a single vertex with $m$ outgoing and incoming lines.
Note that $\pr{\tfr{1}{m!}}^2\sum_{\mr{Einstein}}$ is baked into the definition (see \Cref{dfn:graph} and \Cref{ax:rules-of-interpretation}).
\begin{align*}
\diagram{
  \node[draw] (label) at (-0.7,0) {\bm{v}};
  \node[dot=white] (v1) at (0,0) {};
  \node (dots) at (0.6,0) {$\cdots$};
  \node[dot=white] (vn) at (1.2,0) {};
  \draw (label)--(v1)--(dots)--(vn);
  \draw[->-] (v1) to ++(0,+0.45);
  \draw[->-] (vn) to ++(0,+0.45);
  \draw[-<-] (v1) to ++(0,-0.45);
  \draw[-<-] (vn) to ++(0,-0.45);
}
\equiv&\
  \pr{\tfr{1}{m!}}^2
  \sum_{\mr{Einstein}}
  \ol{v}_{p_1\cdots p_m}^{q_1\cdots q_m}
  a^{p_1\cdots p_m}_{q_1\cdots q_m}
\equiv
\diagram{
  \node[draw,circle] (label) at (0,0) {\bm{v}};
  \draw[->-] (label.140) -- ++(140:0.5) ++(140:0.2);
  \draw[->-] (label.120) -- ++(120:0.5) ++(120:0.2);
  \node at (70:0.55) {$\cdot$};
  \node at (80:0.55) {$\cdot$};
  \node at (90:0.55) {$\cdot$};
  \draw[->-] (label.40)  -- ++(40:0.5)  ++(40:0.25);
  \draw[-<-] (label.220) -- ++(220:0.5) ++(220:0.2);
  \draw[-<-] (label.240) -- ++(240:0.5) ++(240:0.2);
  \node at (270:0.55) {$\cdot$};
  \node at (280:0.55) {$\cdot$};
  \node at (290:0.55) {$\cdot$};
  \draw[-<-] (label.320) -- ++(320:0.5) ++(320:0.25);
}
&&&
\diagram{
  \node[draw] (label) at (-0.7,0) {\bm{v}};
  \node[dot=white] (v1) at (0,0) {};
  \node (dots) at (0.6,0) {$\cdots$};
  \node[dot=white] (vn) at (1.2,0) {};
  \draw (label)--(v1)--(dots)--(vn);
  \draw[->-] (v1) to ++(0,+0.45) node[above] {$p_1$};
  \draw[->-] (vn) to ++(0,+0.45) node[above] {$p_m$};
  \draw[-<-] (v1) to ++(0,-0.45) node[below] {$q_1$};
  \draw[-<-] (vn) to ++(0,-0.45) node[below] {$q_m$};
}
=&\
  \ol{v}_{p_1\cd p_m}^{q_1\cd q_m}a^{p_1\cd p_m}_{q_1\cd q_m}
\\
\diagram{
  \node[draw] (label) at (-0.7,0) {\bm{v}};
  \node[ddot=white] (v1) at (0,0) {};
  \node (dots) at (0.6,0) {$\cdots$};
  \node[ddot=white] (vn) at (1.2,0) {};
  \draw (label)--(v1)--(dots)--(vn);
  \draw[->-] (v1) to ++(0,+0.45);
  \draw[->-] (vn) to ++(0,+0.45);
  \draw[-<-] (v1) to ++(0,-0.45);
  \draw[-<-] (vn) to ++(0,-0.45);
}
\equiv&\
  \pr{\tfr{1}{m!}}^2
  \sum_{\mr{Einstein}}
  \ol{v}_{p_1\cdots p_m}^{q_1\cdots q_m}
  \tl{a}^{p_1\cdots p_m}_{q_1\cdots q_m}
\equiv
\diagram{
  \node[draw,double,circle] (label) at (0,0) {\bm{v}};
  \draw[->-] (label.140) -- ++(140:0.5) ++(140:0.2);
  \draw[->-] (label.120) -- ++(120:0.5) ++(120:0.2);
  \node at (70:0.55) {$\cdot$};
  \node at (80:0.55) {$\cdot$};
  \node at (90:0.55) {$\cdot$};
  \draw[->-] (label.40)  -- ++(40:0.5)  ++(40:0.25);
  \draw[-<-] (label.220) -- ++(220:0.5) ++(220:0.2);
  \draw[-<-] (label.240) -- ++(240:0.5) ++(240:0.2);
  \node at (270:0.55) {$\cdot$};
  \node at (280:0.55) {$\cdot$};
  \node at (290:0.55) {$\cdot$};
  \draw[-<-] (label.320) -- ++(320:0.5) ++(320:0.25);
}
&&&
\diagram{
  \node[draw,circle] (label) at (0,0) {\bm{v}};
  \draw[->-] (label.140) -- ++(140:0.5) ++(140:0.2) node {$p_1$};
  \draw[->-] (label.120) -- ++(120:0.5) ++(120:0.2) node {$p_2$};
  \node at (70:0.55) {$\cdot$};
  \node at (80:0.55) {$\cdot$};
  \node at (90:0.55) {$\cdot$};
  \draw[->-] (label.40)  -- ++(40:0.5)  ++(40:0.25)  node {$p_m$};
  \draw[-<-] (label.220) -- ++(220:0.5) ++(220:0.2) node {$q_1$};
  \draw[-<-] (label.240) -- ++(240:0.5) ++(240:0.2) node {$q_2$};
  \node at (270:0.55) {$\cdot$};
  \node at (280:0.55) {$\cdot$};
  \node at (290:0.55) {$\cdot$};
  \draw[-<-] (label.320) -- ++(320:0.5) ++(320:0.25) node {$q_m$};
}
=&\
  \ol{v}_{p_{\pi(1)}\cd p_{\pi(m)}}^{q_{\si(1)}\cd q_{\si(m)}}
  a^{p_{\pi(1)}\cd p_{\pi(m)}}_{q_{\si(1)}\cd q_{\si(m)}}
\end{align*}
The labeled diagrams on the right represent just the summand of the operator, which highlights the difference between representations.
Both summands correspond to an excitation operator weighted by its antisymmetrized interaction tensor,\footnotemark\ but whereas the Goldstone summand specifies an ordering for the indices of its corresponding algebraic term, the Hugenholtz summand does not.
Since the phases of $\ol{v}_{p_1\cd p_m}^{q_1\cd q_m}$ and $a^{p_1\cd p_m}_{q_1\cd q_m}$ cancel under index permutation, the two labeled diagrams are actually equal -- a Hugenholtz summand can be expanded into a Goldstone summand by simply choosing an arbitrary ordering for the indices.
In practice, the symmetry of the Hugenholtz operator simplifies the enumeration of Wick expansions whereas the Goldstone operator makes it easier to evaluate a graph's overall phase.
\end{dfn}
\footnotetext{In the original paper [J.~Goldstone, \textit{P.~Roy.~Soc.~A} \textbf{239}, (1957)], Goldstone's diagrams were actually defined in terms of non-antisymmetrized integrals.  The \textit{antisymmetrized Goldstone diagrams} used here are sometimes called \textit{Brandow diagrams}.}


\begin{dfn}\label{dfn:graph}
\thmtitle{Graph}
A \textit{graph}\footnotemark\
is a 4-tuple $G=(O,L,h,t)$ where $O$ is a set of electron operators, $L$ is a set of lines, and $h$ and $t$ are maps from $L$ to $O$ that return the \textit{head} $h(l)\in O$ and \textit{tail end} $t(l)\in O$ of every line $l\in L$.
The notation $l\sim l'$ is used to indicate that $l$ and $l'$ are \textit{equivalent lines}, which means that they have the same head and tail.
Here, we allow for \textit{external lines} in which either $h(l)$ or $t(l)$ equals $e$, the \textit{free end}, which is formally considered a member of $O$.
Lines with no free end are termed \textit{internal}.
A graph is termed \textit{closed} if it contains no external lines, in which case it represents a scalar-valued algebraic term.
Otherwise, the graph is \textit{open} and represents an operator-valued algebraic term.
The \textit{rules of interpretation} for translating $G$ into an algebraic expression are given in \Cref{ax:rules-of-interpretation}.
\end{dfn}
\footnotetext{In group theory jargon this is essentially a \textit{directed multigraph}, except that the vertical ordering of operators matters.}

\begin{dfn}
\thmtitle{Connected and linked graphs}
Two lines are \textit{adjacent} if they share a non-free end.
In a Goldstone diagram, two lines are termed \textit{Goldstone adjacent} if they end on the same single-excitation vertex of an operator.
The broader sense of the adjacency is then called \textit{Hugenholtz adjacency}.
A \textit{path} is a sequence of lines $(l_1,\ld,l_n)$ such that $l_i$ is adjacent to $l_{i+1}$ and no line is repeated.
In a Goldstone diagram, a \textit{Goldstone path} is a path whose lines are Goldstone adjacent.
Following the same nomenclature, paths in the broader sense can also be called \textit{Hugenholtz paths}.
A \textit{Goldstone cycle} is a Goldstone path whose ends are either Goldstone adjacent or free.
In the first case we call the Goldstone cycle a \textit{loop} and, in the second case, we call it an \textit{open cycle}.
A graph is considered \textit{connected} if there is a Hugenholtz path connecting any two of its operators.
A disconnected component of a graph that is closed unto itself is termed \textit{unlinked}.
That is, provided none if its disconnected parts are closed, a \textit{disconnected} graph may still be classified as \textit{linked}.
\end{dfn}

\begin{dfn}
\thmtitle{Summand graph}
A \textit{summand graph}\footnotemark\ $\Si(G)$ of $G$ is a 3-tuple $\Si(G)=(G,S,s)$ where $S$ is a set of symbols and $s:L\rightarrow S$ is a \textit{label map} assigning one symbol $s(l)\in S$ to each line $l\in L$.
Pictorially, this corresponds to labeling each line in $G$ with an index, $p,q,r,s,$ etc.
$\Si(G)$ translates directly into an algebraic summand according to \Cref{dfn:operators-in-diagram-notation} and \Cref{ntt:diagram-notation}, with top-to-bottom ordering in the graph corresponding to left-to-right ordering in the expression.
\end{dfn}
\footnotetext{In group theory jargon this is an \textit{edge-labeled directed multigraph}.}

\begin{drv}\label{drv:phase-rule-for-goldstone-cycles}
\thmtitle{Phase rule for simplifying summand graphs with contractions}
The summand graph of a pair of $m$-electron operators with a single particle or hole contraction has the following form in Goldstone representation
\begin{align*}
\diagram{
  %top operator
  \node[dot=white] (a1) at (0.0,+1) {};
  \path (a1) to
    ++(0.6,0) node (adots1) {$\cdots$} to
    ++(0.6,0) node[dot=white] (ai) {} to 
    ++(0.6,0) node (adots2) {$\cdots$} to
    ++(0.6,0) node[dot=white] (am) {};
  \path (am) to ++(+0.6,0) node[draw] (alabel) {$\bm{v}$};
  \draw[->-] (a1) to ++(0,+0.5) node[above] {$p_1$};
  \draw[-<-] (a1) to ++(0,-0.5) node[below] {$q_1$};
  \draw[->-] (ai) to ++(0,+0.5) node[above] {$p_i$};
  \draw[->-] (am) to ++(0,+0.5) node[above] {$p_m$};
  \draw[-<-] (am) to ++(0,-0.5) node[below] {$q_m$};
  \draw (a1) to (adots1) to (ai) to (adots2) to (am) to (alabel);
  %bottom operator
  \node[dot=white] (b1) at (0.6,-1) {};
  \path (b1) to
    ++(0.6,0) node (bdots1) {$\cdots$} to
    ++(0.6,0) node[dot=white] (bj) {} to 
    ++(0.6,0) node (bdots2) {$\cdots$} to
    ++(0.6,0) node[dot=white] (bn) {};
  \path (b1) to ++(-0.6,0) node[draw] (blabel) {$\bm{w}$};
  \draw (blabel) to (b1) to (bdots1) to (bj) to (bdots2) to (bn);
  \draw[->-] (b1) to ++(0,+0.5) node[above] {$r_1$};
  \draw[-<-] (b1) to ++(0,-0.5) node[below] {$s_1$};
  \draw[-<-] (bj) to ++(0,-0.5) node[below] {$s_j$};
  \draw[->-] (bn) to ++(0,+0.5) node[above] {$r_n$};
  \draw[-<-] (bn) to ++(0,-0.5) node[below] {$s_n$};
  %connection
  \path (ai) to node[midway,label=north east:$d$] (midpt) {} (bj);
  \draw[->-] (bj) to[bend right=10] (midpt) to[bend left=10] (ai);
}
\begin{array}{c@{\ }l}
=
&
  \ol{v}^{q_1\cd d\cd q_m}_{p_1\cd p_i\cd p_m}
  \ol{w}^{s_1\cd s_j\cd s_n}_{r_1\cd d\cd r_n} \cdot
\\[5pt]
&
  \no{
    a^{p_1\cd p_i\cd p_m}_{q_1\cd d^\ptcl\cd q_m}
    a^{r_1\cd d^\ptcl\cd r_n}_{s_1\cd s_j\cd s_n}
  }
\end{array}
&&
\diagram{
  %top operator
  \node[dot=white] (a1) at (0.0,+1) {};
  \path (a1) to
    ++(0.6,0) node (adots1) {$\cdots$} to
    ++(0.6,0) node[dot=black] (ai) {} to 
    ++(0.6,0) node (adots2) {$\cdots$} to
    ++(0.6,0) node[dot=white] (am) {};
  \path (am) to ++(+0.6,0) node[draw] (alabel) {$\bm{v}$};
  \draw[->-] (a1) to ++(0,+0.5) node[above] {$p_1$};
  \draw[-<-] (a1) to ++(0,-0.5) node[below] {$q_1$};
  \draw[-<-] (ai) to ++(0,+0.5) node[above] {$q_i$};
  \draw[->-] (am) to ++(0,+0.5) node[above] {$p_m$};
  \draw[-<-] (am) to ++(0,-0.5) node[below] {$q_m$};
  \draw (a1) to (adots1) to (ai) to (adots2) to (am) to (alabel);
  %bottom operator
  \node[dot=white] (b1) at (0.6,-1) {};
  \path (b1) to
    ++(0.6,0) node (bdots1) {$\cdots$} to
    ++(0.6,0) node[dot=black] (bj) {} to 
    ++(0.6,0) node (bdots2) {$\cdots$} to
    ++(0.6,0) node[dot=white] (bn) {};
  \path (b1) to ++(-0.6,0) node[draw] (blabel) {$\bm{w}$};
  \draw (blabel) to (b1) to (bdots1) to (bj) to (bdots2) to (bn);
  \draw[->-] (b1) to ++(0,+0.5) node[above] {$r_1$};
  \draw[-<-] (b1) to ++(0,-0.5) node[below] {$s_1$};
  \draw[->-] (bj) to ++(0,-0.5) node[below] {$r_j$};
  \draw[->-] (bn) to ++(0,+0.5) node[above] {$r_n$};
  \draw[-<-] (bn) to ++(0,-0.5) node[below] {$s_n$};
  %connection
  \path (ai) to node[midway,label=north east:$k$] (midpt) {} (bj);
  \draw[-<-] (bj) to[bend right=10] (midpt) to[bend left=10] (ai);
}
\begin{array}{c@{\ }l}
=
&
  \ol{v}^{q_1\cd q_i\cd q_m}_{p_1\cd k\cd p_m}
  \ol{w}^{s_1\cd k\cd s_n}_{r_1\cd r_j\cd r_n} \cdot
\\[5pt]
&
  \no{
    a^{p_1\cd k^\hole\cd p_m}_{q_1\cd q_i\cd q_m}
    a^{r_1\cd r_j\cd r_n}_{s_1\cd k^\hole\cd s_n}
  }
\end{array}
\end{align*}
where $d$ is a virtual index, $k$ is an occupied index, and we are not using implicit summation.
Notice that $a^{p_1\cd p_n}_{q_1\cd q_n}=\no{a^{p_1}_{q_1}\cd a^{p_n}_{q_n}}$ and that moving the single-excitation operators around in the string always involves an even number of transpositions.
This allows us to bring together the contracted pair of single-excitation operators without changing the sign of the expression.
The contracted pair of operators can then be eliminated via
\begin{align*}
  \no{a^{p_i}_{d^\ptcl}a^{d^\ptcl}_{s_j}}
=
-
  \no{a^{d^\ptcl p_i}_{d^\ptcl s_j}}
=
-
  (-\h^d_d)
  a^{p_i}_{s_j}
=
  a^{p_i}_{s_j}
&&
  \text{or}
&&
  \no{a^{k^\hole}_{q_i}a^{r_j}_{k^\hole}}
=
-
  \no{a^{k^\hole r_j}_{k^\hole q_i}}
=
-
  (+\g^k_k)
  a^{r_j}_{q_i}
=
-
  a^{r_j}_{q_i}
\end{align*}
in the case of a particle or hole contraction, respectively.
In words, a contracted pair of operators in a summand graph can be eliminated by joining their uncontracted partners into a new single-excitation operator and multiplying by $-1$ in the case of a hole contraction.
Applying this rule to each internal line of a Goldstone cycle, one finds that
\begin{enumerate}
\item
  eliminating all contracted operators of an \textit{open cycle} leaves $(-)^h a^p_q$, where $p$ and $q$ are the indices of the free ends
\item
  eliminating all contracted operators of a \textit{loop} leaves $(-)^h a^{d^\ptcl}_{d^\ptcl}=(-)^h(-\h^d_d)=(-)^{h+1}$
\end{enumerate}
where $h$ is the total number of hole lines in the Goldstone cycle.
Since the lines of any Goldstone graph uniquely partition into Goldstone cycles, these rules provide a quick way to resolve the operator component of any diagram into a normal-ordered product of uncontracted operators times a phase factor.
\end{drv}

\begin{cor}
\thmtitle{Phase rule for closed graphs}
\thmstatement{
  After eliminating all contracted operator pairs, the sign of a closed summand graph is $(-)^{h+l}$, where $h$ is the total number of holes in the graph and $l$ is the number of loops.
}
\thmproof{
  By definition, every Goldstone cycle in a closed graph is a loop.
  Let $h_i$ be the number of holes in the $i\eth$ loop.
  Then, by \Cref{drv:phase-rule-for-goldstone-cycles}, the fully contracted operator product evaluates to
  $
    \prod_{i=1}^l (-)^{h_i+1}
  =
    (-)^{{\sum_i}{h_i} +\, l}
  =
    (-)^{h+\,l}
  $.
}
\end{cor}

\begin{dfn}
\thmtitle{Degeneracy}
The \textit{line degeneracy} or simply \textit{degeneracy} of $G$ is the number of permutational symmetries in $\Si(G)$, a positive integer here denoted $\mr{dg}(G)$.
Formally, this can be defined as follows.
If $S=\{s_1,\ld,s_n\}$ is the label set of $\Si(G)$ and $s(l_i)=s_i$ is its label map, we can define a new summand graph $\Si_{\pi}(G)=(G, S, s_{\pi})$ with a permuted label map $s_\pi$ given by $s_{\pi}(l_i)=s_{\pi(i)}$, where $\pi$ is a permutation in $\mr{S}_n$.
Then $\mr{dg}(G)$ is the number of $\Si_{\pi}(G)$ that are equal to $\Si(G)$.
If $L_1\cup\cd\cup L_{m}$ partitions the line set of $G$ into equivalent lines and $|L_i|$ denotes the number of elements in $L_i$, then $\mr{dg}(G)=|L_1|!\cd|L_{m}|!$.
The degeneracy factor becomes slightly more complicated for graphs with repeated operators, which will be considered below in \cref{subsec:repeated-operators}.
\end{dfn}

\begin{ax}\label{ax:rules-of-interpretation}
\thmtitle{Rules of interpretation}
The algebraic intepretation of $G$ is obtained from $\Si(G)$ as follows.
See \Cref{ex:graph}.
\begin{enumerate}
  \item Multiply $\Si(G)$ by $\mr{dg}(G)^{-1}$, termed the \textit{degeneracy factor}.
  \item Sum each index in $\Si(G)$ over its range.
\end{enumerate}
Symbolically, these rules can be stated as follows: $G=\fr{1}{\mr{dg}(G)}\sum_{\mr{Einstein}}\Si(G)$.
\end{ax}

\begin{ex}
The one- and two-electron components of $H_e$ expand into occupied/virtual blocks as follows.
\begin{align*}
  h_p^qa^p_q
=&\
  h_a^ba^a_b
+
  h_a^ia^a_i
+
  h_i^aa^i_a
+
  h_i^ja^i_j
\\
  \tfr{1}{4}
  \ol{g}_{pq}^{rs}a^{pq}_{rs}
=&\
  \tfr{1}{4}
  \ol{g}_{ab}^{cd}a^{ab}_{cd}
+
  \tfr{1}{2}
  \ol{g}_{ab}^{ci}a^{ab}_{ci}
+
  \tfr{1}{2}
  \ol{g}_{ai}^{bc}a^{ai}_{bc}
+
  \tfr{1}{4}
  \ol{g}_{ab}^{ij}a^{ab}_{ij}
+
  \ol{g}_{ia}^{bj}a^{ia}_{bj}
+
  \tfr{1}{4}
  \ol{g}_{ij}^{ab}a^{ij}_{ab}
+
  \tfr{1}{2}
  \ol{g}_{ia}^{jk}a^{ia}_{jk}
+
  \tfr{1}{2}
  \ol{g}_{ij}^{ka}a^{ij}_{ka}
+
  \tfr{1}{4}
  \ol{g}_{ij}^{kl}a^{ij}_{kl}
\end{align*}
which, defining
$
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[dot=white] (h1) {}; 
  \draw[->-] (h1) to ++(0,+0.35);
  \draw[-<-] (h1) to ++(0,-0.35);
}
\equiv
  h_p^qa_q^p
$
and
$
\diagram{
  \interaction{2}{g}{(0,0)}{dot=white}{sawtooth};
  \draw[->-] (g1) to ++(0,+0.35);
  \draw[-<-] (g1) to ++(0,-0.35);
  \draw[->-] (g2) to ++(0,+0.35);
  \draw[-<-] (g2) to ++(0,-0.35);
}
\equiv
  \textstyle\frac{1}{4}\overline{g}_{pq}^{rs}a_{rs}^{pq}
$,
can be expressed in terms of Goldstone diagrams as
\begin{align*}
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[dot=white] (h1) {};
  \draw[->-] (h1) to ++(0,+0.5);
  \draw[-<-] (h1) to ++(0,-0.5);
}
=&\
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[dot] (h1) {};
  \draw[->-] (h1) to ++(0,+0.5);
  \draw[-<-] (h1) to ++(0,-0.5);
}
+
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[dot] (h1) {};
  \draw[->-] (h1) to ++(-0.25,+0.5);
  \draw[-<-] (h1) to ++(+0.25,+0.5);
}
+
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[dot] (h1) {};
  \draw[->-] (h1) to ++(-0.25,-0.5);
  \draw[-<-] (h1) to ++(+0.25,-0.5);
}
+
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[dot] (h1) {};
  \draw[->-] (h1) to ++(0,-0.5);
  \draw[-<-] (h1) to ++(0,+0.5);
}
\\
\diagram{
  \interaction{2}{g}{(0,0)}{dot=white}{sawtooth};
  \draw[->-] (g1) to ++(0,+0.5);
  \draw[-<-] (g1) to ++(0,-0.5);
  \draw[->-] (g2) to ++(0,+0.5);
  \draw[-<-] (g2) to ++(0,-0.5);
}
=&\
\diagram{
  \interaction{2}{g}{(0,0)}{dot}{sawtooth};
  \draw[->-] (g1) to ++(0,+0.5);
  \draw[-<-] (g1) to ++(0,-0.5);
  \draw[->-] (g2) to ++(0,+0.5);
  \draw[-<-] (g2) to ++(0,-0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{dot}{sawtooth};
  \draw[->-] (g1) to ++(0,+0.5);
  \draw[-<-] (g1) to ++(0,-0.5);
  \draw[->-] (g2) to ++(-0.25,+0.5);
  \draw[-<-] (g2) to ++(+0.25,+0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{dot}{sawtooth};
  \draw[->-] (g1) to ++(0,+0.5);
  \draw[-<-] (g1) to ++(0,-0.5);
  \draw[->-] (g2) to ++(-0.25,-0.5);
  \draw[-<-] (g2) to ++(+0.25,-0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{dot}{sawtooth};
  \draw[->-] (g1) to ++(-0.25,+0.5);
  \draw[-<-] (g1) to ++(+0.25,+0.5);
  \draw[->-] (g2) to ++(-0.25,+0.5);
  \draw[-<-] (g2) to ++(+0.25,+0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{dot}{sawtooth};
  \draw[->-] (g1) to ++(-0.25,-0.5);
  \draw[-<-] (g1) to ++(+0.25,-0.5);
  \draw[->-] (g2) to ++(-0.25,+0.5);
  \draw[-<-] (g2) to ++(+0.25,+0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{dot}{sawtooth};
  \draw[->-] (g1) to ++(-0.25,-0.5);
  \draw[-<-] (g1) to ++(+0.25,-0.5);
  \draw[->-] (g2) to ++(-0.25,-0.5);
  \draw[-<-] (g2) to ++(+0.25,-0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{dot}{sawtooth};
  \draw[->-] (g1) to ++(0,-0.5);
  \draw[-<-] (g1) to ++(0,+0.5);
  \draw[->-] (g2) to ++(-0.25,+0.5);
  \draw[-<-] (g2) to ++(+0.25,+0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{dot}{sawtooth};
  \draw[->-] (g1) to ++(0,-0.5);
  \draw[-<-] (g1) to ++(0,+0.5);
  \draw[->-] (g2) to ++(-0.25,-0.5);
  \draw[-<-] (g2) to ++(+0.25,-0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{dot}{sawtooth};
  \draw[->-] (g1) to ++(0,-0.5);
  \draw[-<-] (g1) to ++(0,+0.5);
  \draw[->-] (g2) to ++(0,-0.5);
  \draw[-<-] (g2) to ++(0,+0.5);
}\,\,.
\end{align*}
The degeneracy factors fall into three cases: $\{l_1,l_2\}\cup\{l_3,l_4\}\implies \mr{dg}(G)^{-1}=\tfr{1}{2\cdot2}$; $\{l_1,l_2\}\cup\{l_3\}\cup\{l_4\}\implies \mr{dg}(G)^{-1}=\tfr{1}{2\cdot1\cdot1}$; and $\{l_1\}\cup\{l_2\}\cup\{l_3\}\cup\{l_4\}\implies \mr{dg}(G)^{-1}=\tfr{1}{1\cdot1\cdot1\cdot1}$.
In terms of Hugenholtz diagrams, these are written as follows.
\begin{align*}
\diagram{
  \node[dot=white] (h) at (0,0) {};
  \draw[->-] (h) to ++(0,+0.5);
  \draw[-<-] (h) to ++(0,-0.5);
}
=
\diagram{
  \node[dot] (h) at (0,0) {};
  \draw[->-] (h) to ++(0,+0.5);
  \draw[-<-] (h) to ++(0,-0.5);
}
+
\diagram{
  \node[dot] (h) at (0,0) {};
  \draw[->-] (h) to ++(-0.25,+0.5);
  \draw[-<-] (h) to ++(+0.25,+0.5);
}
+
\diagram{
  \node[dot] (h) at (0,0) {};
  \draw[-<-] (h) to ++(-0.25,-0.5);
  \draw[->-] (h) to ++(+0.25,-0.5);
}
+
\diagram{
  \node[dot] (h) at (0,0) {};
  \draw[-<-] (h) to ++(0,+0.5);
  \draw[->-] (h) to ++(0,-0.5);
}
&&
\diagram{
  \node[dot=white] (g) at (0,0) {};
  \draw[->-] (g) to ++(-0.25,+0.5);
  \draw[->-] (g) to ++(+0.25,+0.5);
  \draw[-<-] (g) to ++(-0.25,-0.5);
  \draw[-<-] (g) to ++(+0.25,-0.5);
}
=
\diagram{
  \node[dot] (g) at (0,0) {};
  \draw[->-] (g) to ++(-0.25,+0.5);
  \draw[->-] (g) to ++(+0.25,+0.5);
  \draw[-<-] (g) to ++(-0.25,-0.5);
  \draw[-<-] (g) to ++(+0.25,-0.5);
}
+
\diagram{
  \node[dot] (g) at (0,0) {};
  \draw[->-] (g) to ++(0,+0.5);
  \draw[-<-] (g) to ++(0,-0.5);
  \draw[-<-] (g) to ++(50:0.5);
  \draw[->-] (g) to ++(130:0.5);
}
+
\diagram{
  \node[dot] (g) at (0,0) {};
  \draw[->-] (g) to ++(0,+0.5);
  \draw[-<-] (g) to ++(0,-0.5);
  \draw[-<-] (g) to ++(-50:0.5);
  \draw[->-] (g) to ++(-130:0.5);
}
+
\diagram{
  \newcommand{\ang}{40};
  \node[dot] (g) at (0,0) {};
  \draw[-<-] (g) to ++(90-1.5*\ang:0.5);
  \draw[-<-] (g) to ++(90-0.5*\ang:0.5);
  \draw[->-] (g) to ++(90+0.5*\ang:0.5);
  \draw[->-] (g) to ++(90+1.5*\ang:0.5);
}
+
\diagram{
  \node[dot] (g) at (0,0) {};
  \draw[-<-] (g) to ++(-0.25,+0.5);
  \draw[->-] (g) to ++(+0.25,+0.5);
  \draw[-<-] (g) to ++(-0.25,-0.5);
  \draw[->-] (g) to ++(+0.25,-0.5);
}
+
\diagram{
  \newcommand{\ang}{40};
  \node[dot] (g) at (0,0) {};
  \draw[-<-] (g) to ++(-90+1.5*\ang:0.5);
  \draw[-<-] (g) to ++(-90+0.5*\ang:0.5);
  \draw[->-] (g) to ++(-90-0.5*\ang:0.5);
  \draw[->-] (g) to ++(-90-1.5*\ang:0.5);
}
+
\diagram{
  \node[dot] (g) at (0,0) {};
  \draw[-<-] (g) to ++(0,+0.5);
  \draw[->-] (g) to ++(0,-0.5);
  \draw[-<-] (g) to ++(50:0.5);
  \draw[->-] (g) to ++(130:0.5);
}
+
\diagram{
  \node[dot] (g) at (0,0) {};
  \draw[-<-] (g) to ++(0,+0.5);
  \draw[->-] (g) to ++(0,-0.5);
  \draw[-<-] (g) to ++(-50:0.5);
  \draw[->-] (g) to ++(-130:0.5);
}
+
\diagram{
  \node[dot] (g) at (0,0) {};
  \draw[-<-] (g) to ++(-0.25,+0.5);
  \draw[-<-] (g) to ++(+0.25,+0.5);
  \draw[->-] (g) to ++(-0.25,-0.5);
  \draw[->-] (g) to ++(+0.25,-0.5);
}
\end{align*}
Note that in each case the correct scalar factor is built into the definition of the diagram.
\end{ex}

\begin{dfn}
\thmtitle{Contraction}
Formally, a \textit{graph contraction} is a map $G\mapsto c(G)$ joining one or more compatible external lines in $G$.
For example, $c$ might replace $l_1$ and $l_2$, which have ends $(t(l_1),h(l_1))=(o_1,e)$ and $(t(l_2),h(l_2))=(e,o_2)$, with $l_{12}$, which has ends $(t(l_{12}),h(l_{12}))=(o_1,o_2)$.
Two contractions $c$ and $c'$ of $G$ are \textit{equivalent} if $c(G)=c'(G)$.
The number of equivalent ways of achieving a given contraction $c$ is called its \textit{pattern degeneracy}, which is denoted $\mr{pat}(c)$.
The complete set of inequivalent graph contractions of $G$ is here denoted $\mr{Ctr}(G)$.
\end{dfn}

\begin{samepage}
\begin{ex}
The $\F$-normal Wick expansion of the one- and two-electron components of $H_e$ are as follows.
\begin{align*}
  h_p^qa^p_q
=&\
  h_p^q
  \pr{
    \tl{a}^p_q
  +
    \tl{a}^{p^\hole}_{q^\hole}
  }
=
  h_p^q
  \tl{a}^p_q
+
  h_p^q
  \g^p_q
\\
  \tfr{1}{4}
  \ol{g}_{pq}^{rs}
  a^{pq}_{rs}
=&\
  \tfr{1}{4}
  \ol{g}_{pq}^{rs}
  \pr{
    \tl{a}^{pq}_{rs}
  +
    \op{P}^{(p/q)}_{(r/s)}
    \tl{a}^{p^\hole q}_{r^\hole s}
  +
    \op{P}_{(r/s)}
    \tl{a}^{p^\hole q^{\hole\hole}}_{r^\hole s^{\hole\hole}}
  }
=
  \tfr{1}{4}
  \ol{g}_{pq}^{rs}
  \tl{a}^{pq}_{rs}
+
  \ol{g}_{pq}^{rs}
  \g^p_r
  \tl{a}^q_s
+
  \tfr{1}{2}
  \ol{g}_{pq}^{rs}
  \g^p_r
  \g^q_s
\end{align*}
In terms of Goldstone diagrams and Hugenholtz diagrams, these equations are written as follows.
\begin{align*}
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[dot=white] (h1) {};
  \draw[->-] (h1) to ++(0,+0.5);
  \draw[-<-] (h1) to ++(0,-0.5);
}
=&\
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[ddot=white] (h1) {};
  \draw[->-] (h1) to ++(0,+0.5);
  \draw[-<-] (h1) to ++(0,-0.5);
}
+
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[ddot=white] (h1) {};
  \draw[-<-] (h1) arc (0:360:-0.25);
}
&
\diagram{
  \interaction{2}{g}{(0,0)}{dot=white}{sawtooth};
  \draw[->-] (g1) to ++(0,+0.5);
  \draw[-<-] (g1) to ++(0,-0.5);
  \draw[->-] (g2) to ++(0,+0.5);
  \draw[-<-] (g2) to ++(0,-0.5);
}
=&\
\diagram{
  \interaction{2}{g}{(0,0)}{ddot=white}{sawtooth};
  \draw[->-] (g1) to ++(0,+0.5);
  \draw[-<-] (g1) to ++(0,-0.5);
  \draw[->-] (g2) to ++(0,+0.5);
  \draw[-<-] (g2) to ++(0,-0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{ddot=white}{sawtooth};
  \draw[->-] (g1) arc (0:360:+0.25);
  \draw[->-] (g2) to ++(0,+0.5);
  \draw[-<-] (g2) to ++(0,-0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{ddot=white}{sawtooth};
  \draw[->-] (g1) arc (0:360:+0.25);
  \draw[-<-] (g2) arc (0:360:-0.25);
}
\\
\updownarrow\hspace{1pt}&
&
\updownarrow\hspace{1pt}&
\\
\diagram{
  \node[dot=white] (h) at (0,0) {};
  \draw[->-] (h) to ++(0,+0.5);
  \draw[-<-] (h) to ++(0,-0.5);
}
=&\
\diagram{
  \node[ddot=white] (h) at (0,0) {};
  \draw[->-]  (h) to ++(0,+0.5);
  \draw[-<-]  (h) to ++(0,-0.5);
}
+
\diagram{
  \node[ddot=white] (h) at (0,0) {};
  \draw[-<-]  (h) arc (0:360:-0.25);
}
&
\diagram{
  \node[dot=white] (g) at (0,0) {};
  \draw[->-] (g) to ++(+0.25,+0.5);
  \draw[-<-] (g) to ++(+0.25,-0.5);
  \draw[->-] (g) to ++(-0.25,+0.5);
  \draw[-<-] (g) to ++(-0.25,-0.5);
}
=&\
\diagram{
  \node[ddot=white] (g) at (0,0) {};
  \draw[->-] (g) to ++(+0.25,+0.5);
  \draw[-<-] (g) to ++(+0.25,-0.5);
  \draw[->-] (g) to ++(-0.25,+0.5);
  \draw[-<-] (g) to ++(-0.25,-0.5);
}
+
\diagram{
  \node[ddot=white] (g) at (0,0) {};
  \draw[->-] (g) arc (0:360:+0.25);
  \draw[->-] (g) to ++(0,+0.5);
  \draw[-<-] (g) to ++(0,-0.5);
}
+
\diagram{
  \node[ddot=white] (g) at (0,0) {};
  \draw[->-] (g) arc (0:360:+0.25);
  \draw[-<-] (g) arc (0:360:-0.25);
}
\end{align*}
Note that here too each degeneracy factor is exactly equal to the scalar factor in front of the corresponding algebraic term.
This follows from the diagrammatic statement of Wick's theorem, which is given below (\Cref{thm:wicks-theorem-for-diagrams}).
\end{ex}
\end{samepage}

\begin{ex}
The $\F$-normal Wick expansion of $H_e$ in terms of Goldstone diagrams is
\begin{align*}
  H_e
=
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[dot=white] (h1) {};
  \draw[->-] (h1) to ++(0,+0.5);
  \draw[-<-] (h1) to ++(0,-0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{dot=white}{sawtooth};
  \draw[->-] (g1) to ++(0,+0.5);
  \draw[->-] (g2) to ++(0,+0.5);
  \draw[-<-] (g1) to ++(0,-0.5);
  \draw[-<-] (g2) to ++(0,-0.5);
}
=
\underset{E_0}{\underbrace{
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[ddot=white] (h1) {};
  \draw[-<-] (h1) arc (0:360:-0.25);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{ddot=white}{sawtooth};
  \draw[->-] (g1) arc (0:360:+0.25);
  \draw[-<-] (g2) arc (0:360:-0.25);
}
}}
+
\underset{H_{\mr{c}}}{\underbrace{
\diagram{
  \draw (-0.5,0) node[circlex] (f) {} -- (0,0) node[ddot=white] (f1) {};
  \draw[->-] (f1) to ++(0,+0.5);
  \draw[-<-] (f1) to ++(0,-0.5);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{ddot=white}{sawtooth};
  \draw[->-] (g1) to ++(0,+0.5);
  \draw[->-] (g2) to ++(0,+0.5);
  \draw[-<-] (g1) to ++(0,-0.5);
  \draw[-<-] (g2) to ++(0,-0.5);
}
}}
\end{align*}
  where
$
\diagram{
  \draw (-0.5,0) node[circlex] (f) {} -- (0,0) node[ddot=white] (f1) {};
  \draw[->-] (f1) to ++(0,+0.3);
  \draw[-<-] (f1) to ++(0,-0.3);
}
\equiv
\diagram{
  \draw (-0.5,0) node[squarex] (h) {} -- (0,0) node[ddot=white] (h1) {};
  \draw[->-] (h1) to ++(0,+0.3);
  \draw[-<-] (h1) to ++(0,-0.3);
}
+
\diagram{
  \interaction{2}{g}{(0,0)}{ddot=white}{sawtooth};
  \draw[->-] (g1) arc (0:360:+0.25);
  \draw[->-] (g2) to ++(0,+0.3);
  \draw[-<-] (g2) to ++(0,-0.3);
}
$
is the $\F$-normal-ordered Fock operator,
$
  f_p^q\tl{a}^p_q
=
  h_p^q\tl{a}^p_q
+
  \ol{g}_{pr}^{qs}\g^r_s\tl{a}^p_q
$.
\end{ex}

\begin{lem}\label{lem:pattern-degeneracy-no-identical-operators}
\thmstatement{The pattern degeneracy of a contraction $c$ is $\mr{pat}(c)=\dfr{\mr{dg}(G)}{\mr{dg}(c(G))}$.
}
\thmproof{
  Let $L$ be the line set of $G$ and let $L_c$ be the line set of $c(G)$.
  If $L=L_1\cup\cd\cup L_m$ partitions $L$ into equivalent lines, let $L_{i,j}=L_{j,i}$ denote the subset of lines in $L_c$ that result from contracting lines from $L_i$ with lines from $L_j$.
  Let $L_{i,0}$ denote the subset of lines from $L_i$ which is unchanged by $c$.
  Then $L_c=\bigcup_{i>j} L_{i,j}=\bigcup_{i=1}^m \pr{L_{i,0}\cup L_{i,1}\cup\cd L_{i,i-1}}$ partitions $L_c$ into equivalent lines.
  By standard counting techniques, the number of equivalent ways of partitioning $L_i$ for contraction is $|L_i|$ choose $|L_{i,0}|,|L_{i,1}|,\cd,|L_{i,m}|$, and the number of ways of forming $L_{i,j}$ from a given partition of $L_i$ and $L_j$ is $|L_{i,j}|!=|L_{j,i}|!$.
  Therefore, the total pattern degeneracy of $c$ is
  \begin{align*}
    \mr{pat}(c)
  =
    \prod_{i=1}^m
    {|L_i| \choose |L_{i,0}|,|L_{i,1}|,\ld,|L_{i,m}|}
    \prod_{i=1}^m
    \prod_{j=i+1}^m
    |L_{i,j}|!
  =
    \fr{
      |L_1|!\cd|L_m|!
    }
    {
      \prod_{i=1}^m
      |L_{i,0}|!
      |L_{i,1}|!\cd|L_{i,i-1}|!
    }
  =
    \fr{\mr{dg}(G)}{\mr{dg}(c(G))}\,.
  \end{align*}
}
\end{lem}

\begin{thm}\label{thm:wicks-theorem-for-diagrams}
\thmtitle{Wick's theorem for diagrams}
\thmstatement{
$\ds{
  G
=
  \no{G}
+
  \sum_{c\in\mr{Ctr}(G)}
  \no{c(G)}
}$
}
\thmproof{
  This follows by expanding $G$ as $\tfr{1}{\mr{dg}(G)}\sum_{\text{Einstein}}\Si(G)$, applying the standard algebraic Wick's theorem to the summand graph,
  $
    \Si(G)
  =
    \no{\Si(G)}
  +
    \sum_{c\in\mr{Ctr}(G)}
    \mr{pat}(c)
    \no{\Si(c(G))}
  $, and writing $\mr{pat}(c)$ as $\fr{\mr{dg}(G)}{\mr{dg}(c(G))}$:
\begin{align*}
  G
=
  \tfr{1}{\mr{dg}(G)}
  \sum_{\mr{Einstein}}
  \Si(G)
=
  \tfr{1}{\mr{dg}(G)}
  \sum_{\mr{Einstein}}
  \no{\Si(G)}
+
  \sum_{c\in\mr{Ctr}(G)}
  \tfr{1}{\mr{dg}(c(G))}
  \sum_{\mr{Einstein}}
  \no{\Si(c(G))}
=
  \no{G}
+
  \sum_{c\in\mr{Ctr}(G)}
  \no{c(G)}
\end{align*}
  In words, any graph is equal to its normal-ordering plus the sum over all unique graph contractions.
}
\end{thm}

\begin{rmk}
The practical advantage of the graphical form of Wick's theorem is that there are far fewer unique graph contractions than there are algebraic contractions.
Effectively, graphical notation makes the permutational symmetries of $m$-electron operators obvious, which tends to make them easier to manipulate.
\end{rmk}

\begin{ntt}
\thmtitle{Vacuum line}
Often, diagrams are used to evaluate vacuum expectation values
$\ip{\vac|\cd|\vac}$
or, in the case of $\F$ normal ordering,
expectation values with respect to the Fermi vacuum
$\ip{\F|\cd|\F}$.
The vacuum ket is graphically depicted by drawing thick double lines
$\diagram[top]{\path (0,-0.08) to ++(0.5,0);}$
below the graph, and the bra is represented by thick double lines above.
\end{ntt}

\begin{dfn}
\thmtitle{Coefficient diagram}
A \textit{coefficient diagram} is a closed graph in which one of the interaction vertices is an antisymmetrized Kronecker delta,
$\ol{v}^{q_1'\cd q_m'}_{p_1'\cd p_m'}=\op{P}^{(p_1/\cd /p_m)}_{(q_1/\cd /q_m)}\d^{p_1}_{p_1'}\cd \d^{p_m}_{p_m'}\d^{q_1'}_{q_1}\cd \d^{q_m'}_{q_m}$.\footnote{This is equivalent to plugging in a dummy interaction vertex $\ol{v}^{q_1'\cd q_m'}_{p_1'\cd p_m'}$ and taking the derivative with respect to $\ol{v}^{q_1\cd q_m}_{p_1\cd p_m}$.}
This is equivalent to deleting this operator and contracting the resulting open diagram with $a^{p_1\cd p_m}_{q_1\cd q_m}$, fixing the index values of the free ends.
Graphically, this is depicted by capping the open ends
$\diagram{\draw[->-] (0,0) to ++(0.5,0) node[smalldot] {};}$
and labelling the annihilation lines with $p_1,\ld,p_m$ and the creation lines with $q_1,\cd,q_m$.
Closed graphs that aren't coefficient diagrams are sometimes called \textit{energy diagrams}, and diagrams that are open on top with a vacuum ket at the bottom are sometimes called \textit{wavefunction diagrams}.
\end{dfn}

\begin{ex}
Consider the following simple examples of coefficient diagrams
\begin{align*}
&&
  \ip{\F|\tl{a}^i_a H_c|\F}
=
\diagram[top, bottom]{
  \node[ddot=black] (a1) at (0.2,+0.7) {};
  \draw (-0.8,-0.5) node[circlex] (f) {} to ++(0.5,0) node[ddot=white] (f1) {};
  \node at (0.2,-0.5) {+};
  \interaction{2}{g}{(0.7,-0.5)}{ddot=white}{sawtooth};
  \draw[->-] (a1) to ++(-0.25,-0.5) node[left]  {\scriptsize$i$};
  \draw[-<-] (a1) to ++(+0.25,-0.5) node[left]  {\scriptsize$a$};
  \draw[->-] (f1) to ++(0,+0.5);
  \draw[-<-] (f1) to ++(0,-0.5);
  \draw[->-] (g1) to ++(0,+0.5);
  \draw[-<-] (g1) to ++(0,-0.5);
  \draw[->-] (g2) to ++(0,+0.5);
  \draw[-<-] (g2) to ++(0,-0.5);
}
=
\diagram{
  \draw (0,-0.5) node[circlex] (f) {} to ++(0.5,0) node[ddot=white] (f1) {};
  \draw[-<-] (f1) to ++(-0.25,+1) node[smalldot,label=north:\scriptsize$i$] {};
  \draw[->-] (f1) to ++(+0.25,+1) node[smalldot,label=north:\scriptsize$a$] {};
}
=
  f_a^i
&&
  \ip{\F|\tl{a}^{ij}_{ab}H_c|\F}
=
\diagram[top, bottom]{
  \interaction{2}{a}{(0,+0.7)}{ddot=black}{densely dotted};
  \draw (-0.8,-0.5) node[circlex] (f) {} to ++(0.5,0) node[ddot=white] (f1) {};
  \node at (0.2,-0.5) {+};
  \interaction{2}{g}{(0.7,-0.5)}{ddot=white}{sawtooth};
  \draw[->-] (a1) to ++(-0.25,-0.5) node[left]  {\scriptsize$i$};
  \draw[-<-] (a1) to ++(+0.25,-0.5) node[left]  {\scriptsize$a$};
  \draw[->-] (a2) to ++(-0.25,-0.5) node[right] {\scriptsize$j$};
  \draw[-<-] (a2) to ++(+0.25,-0.5) node[right] {\scriptsize$b$};
  \draw[->-] (f1) to ++(0,+0.5);
  \draw[-<-] (f1) to ++(0,-0.5);
  \draw[->-] (g1) to ++(0,+0.5);
  \draw[-<-] (g1) to ++(0,-0.5);
  \draw[->-] (g2) to ++(0,+0.5);
  \draw[-<-] (g2) to ++(0,-0.5);
}
=
\diagram{
  \interaction{2}{g}{(0,-0.5)}{ddot=black}{sawtooth};
  \draw[-<-] (g1) to ++(-0.25,+1) node[smalldot,label=north:\scriptsize$i$] {};
  \draw[->-] (g1) to ++(+0.25,+1) node[smalldot,label=north:\scriptsize$a$] {};
  \draw[-<-] (g2) to ++(-0.25,+1) node[smalldot,label=north:\scriptsize$j$] {};
  \draw[->-] (g2) to ++(+0.25,+1) node[smalldot,label=north:\scriptsize$b$] {};
}
=
  \ol{g}_{ab}^{ij}
\end{align*}
where we have simplified the interpreted diagrams as
$
  \sum_{i'a'}
  \d^i_{i'}\d^{a'}_a
  f^{i'}_{a'}
=
  f^i_a
$
and
$
  \pr{\tfr{1}{2}}^2
  \sum_{i'j'a'b'}
  P^{(i/j)}_{(a/b)}
  \d^{a'}_a\d^{b'}_b
  \d^i_{i'}\d^j_{j'}
  \ol{g}_{a'b'}^{i'j'}
=
  \ol{g}^{ij}_{ab}
$.
These are simply the second and third Slater rules in diagrammatic form.
\end{ex}



\subsection{Generalization for repeated operators}\label{subsec:repeated-operators}

\begin{dfn}
Repeated copies of the same operator are formally distinguished as elements of $O$ and are referred to as \textit{identical operators}.
Operators whose interaction vertices can be interchanged without altering the graph are termed \textit{interchangeable operators}.
If two identical operators are interchangeable, they are termed \textit{equivalent}.
\end{dfn}

\begin{dfn}
If $o$ and $o'$ can be exchanged, attaching the ends of one to the other and vice versa, without altering $G$ then they are termed \textit{interchangeable operators}.
If identical operators are interchangeable, they are termed \textit{equivalent}, denoted $o\sim o'$.
See \Cref{ex:equivalent-operators}.
\end{dfn}

\begin{dfn}
\thmtitle{Equivalent subgraph}
If $O'$ and $L'$ are subsets of $O$ and $L$ then $G'=(O',L',h,t)$ is a \textit{subgraph} of $G$, denoted $G'\subseteq G$.
Given an operator subset $O'\subseteq O$, the \textit{subgraph induced by $O'$} is the subgraph $(O',L',h,t)$ where $L'$ contains all lines in $L$ except for those incident on operators not in $O'$.
Suppose $O_1$ and $O_2$ are disjoint subsets of $O$ such that $G[O_1]$ is connected and $G[O_2]$ is connected.
If $G[O_1]$ and $G[O_2]$ can be exchanged in $G$ without altering the graph then we say that they are \textit{interchangeable subgraphs}.
See \Cref{ex:interchangeable-subgraphs}.
If in addition $G[O_1]$ and $G[O_2]$ are interchangeable subgraphs that are identical, we call them \textit{equivalent subgraphs} and write $G[O_1]\sim G[O_2]$.
See \Cref{ex:equivalent-subgraphs}.
If $O_1=\{o_1\}$ and $O_2=\{o_2\}$, then this is the same as saying that $o_1$ and $o_2$ are equivalent operators.
\end{dfn}


\newpage
\appendix

\section{Examples}

\begin{ex}\label{ex:graph}
\thmtitle{Graph}
\begin{align*}
&&
\diagram{
% labels
  \node[draw] (t) at (0,+2.9) {\bm{t}};
  \node[draw] (u) at (0,+1.6) {\bm{u}};
  \node[draw] (v) at (0, 0.3) {\bm{v}};
  \node[draw] (w) at (0,-1.0) {\bm{w}};
  \node[draw] (z) at (0,-2.3) {\bm{z}};
% interaction lines
  \draw (t) -- ++(-0.7,0) node[ddot=blue!20] (t1) {}
            -- ++(-1.0,0) node[ddot=blue!20] (t2) {};
  \draw (u) -- ++(-0.7,0) node[dot=blue!20]  (u1) {};
  \draw (v) -- ++(-0.7,0) node[ddot=blue!20] (v1) {}
            -- ++(-1.0,0) node[ddot=black] (v2) {};
  \draw (w) -- ++(-0.7,0) node[ddot=blue!20] (w1) {}
            -- ++(-1.0,0) node[ddot=black] (w2) {};
  \draw (z) -- ++(-0.7,0) node[ddot=blue!20]  (z1) {}
            -- ++(-1.0,0) node[ddot=blue!20]  (z2) {}
            -- ++(-1.0,0) node[ddot=blue!20]  (z3) {};
% particle-hole lines
  \draw[->-] (t1) to ++(0,+0.5);  \draw[-<-] (t1) to ++(0,-0.5);
  \draw[->-] (t2) arc (0:360:+0.25);
  \draw[->-] (u1) to ++(0,+0.5);  \draw[-<-] (u1) to ++(0,-0.5);
  \draw[->-] (v1) to ++(0,+0.5);
  \draw[->-] (w1) to (v1);
  \draw[->-,bend left]  (w2) to (v2);  \draw[-<-,bend right] (w2) to (v2);
  \draw[->-] (z1) to ++(0,+0.5);  \draw[-<-] (z1) to ++(0,-0.5);
  \draw[-<-] (z2) to ++(0,-0.5);
  \draw[->-] (z3) to ++(0,+0.5);  \draw[-<-] (z3) to ++(0,-0.5);
  \path (-1.7,-2.3) to node[midway] (mid) {} (-0.7,-1.0);
  \draw[->-] (z2) to[bend left] (mid) to[bend right] (w1);
  \padborder{10pt};
}
\equiv
  \fr{1}{2\cdot2\cdot3}
  \sum_{\text{Einstein}}
  \gno{t_{op}^{qr}a^{o^\hole p}_{q^\hole r}}
  \,u_s^ta^s_t\,
  \gno{
    v_{uv}^{wx}a^{u^{\hole\hole} v}_{w^\ptcl x^{\ptcl\ptcl}}
    w_{yz}^{\a\b}
    a^{y^\ptcl z^{\ptcl\ptcl}}_{\a^{\hole\hole} \b^{\ptcl\ptcl\ptcl}}
    z_{\g\d\e}^{\f\h\th}
    a^{\g\d^{\ptcl\ptcl\ptcl}\e}_{\f\h^{\hphantom{\ptcl\ptcl}}\th}
  }
\end{align*}
\end{ex}

\begin{ex}\label{ex:equivalent-operators}
\thmtitle{Equivalent operators}
If $v$ and $v'$ in the following graph are identical, then they are \textit{equivalent operators}, $v\sim v'$.
Otherwise, $v$ and $v'$ are \textit{interchangeable} but \textit{inequivalent operators}.
\begin{align*}
&&
\diagram{
  % labels
  \node[draw,circle,inner sep=5pt] (w) at (0,0) {$\bm{w}$};
  \node[draw,circle,inner sep=1pt] (v) at (-0.5,1) {$\bm{v}\phantom{'}$};
  \node[draw,circle,inner sep=1pt] (v') at (+0.5,1) {$\bm{v}'$};
  \draw[-<-] (w) to ++(-60:1);
  \draw[-<-] (w) to ++(-80:1);
  \draw[-<-] (w) to ++(-100:1);
  \draw[-<-] (w) to ++(-120:1);
  \draw[-<-] (v.-40) to (w.100);
  \draw[-<-] (v.-90) to (w.120);
  \draw[-<-] (v'.-90) to (w.60);
  \draw[-<-] (v'.-140) to (w.80);
  \draw[->-] (v.115) to ++(0,0.5);
  \draw[->-] (v.65)  to ++(0,0.5);
  \draw[->-] (v'.115) to ++(0,0.5);
  \draw[->-] (v'.65)  to ++(0,0.5);
}
\end{align*}
\end{ex}

\begin{ex}\label{ex:interchangeable-subgraphs}
\thmtitle{Interchangeable subgraphs}
$G[\{x_1,w_1,v_{11},v_{12}\}]$ and $G[\{x_2,w_2,v_{21},v_{22}\}]$ in the following graph are interchangeable subgraphs.
Also, $G[\{v_{11}\}]$ is interchangeable with $G[\{v_{12}\}]$ and $G[\{v_{21}\}]$ is interchangeable with $G[\{v_{22}\}]$.
\begin{align*}
&&
\diagram{
  \node[draw,circle,inner sep=5pt] (y) at (0,0) {$\bm{y}$};
  \node[draw,circle,inner sep=2pt] (x1) at (-1,0.5) {$\bm{x}_1$};
  \node[draw,circle,inner sep=2pt] (x2) at (+1,0.5) {$\bm{x}_2$};
  \node[draw,circle,inner sep=2pt] (w1) at (-1,1.5) {$\bm{w}_1$};
  \node[draw,circle,inner sep=2pt] (w2) at (+1,1.5) {$\bm{w}_2$};
  \node[draw,circle,inner sep=0pt] (v11) at (-1.35,2.5) {$\bm{v}_{11}$};
  \node[draw,circle,inner sep=0pt] (v12) at (-0.65,2.5) {$\bm{v}_{12}$};
  \node[draw,circle,inner sep=0pt] (v22) at (+0.65,2.5) {$\bm{v}_{21}$};
  \node[draw,circle,inner sep=0pt] (v21) at (+1.35,2.5) {$\bm{v}_{22}$};
  \draw[-<-] (y) to ++(-70:0.9);
  \draw[-<-] (y) to ++(-110:0.9);
  \draw[->-] (y) to (x1);
  \draw[->-] (y) to (x2);
  \draw[->-] (x1) to (w1);
  \draw[->-] (x2) to (w2);
  \draw[->-] (w1) to (v11);
  \draw[->-] (w1) to (v12);
  \draw[->-] (w2) to (v21);
  \draw[->-] (w2) to (v22);
  \draw[->-] (v11) to ++(0,+0.7);
  \draw[->-] (v12) to ++(0,+0.7);
  \draw[->-] (v21) to ++(0,+0.7);
  \draw[->-] (v22) to ++(0,+0.7);
}
\end{align*}
\end{ex}

\begin{ex}\label{ex:equivalent-subgraphs}
\thmtitle{Equivalent subgraphs}
If $v\simeq v'$ and $x\simeq x'$ in the following graph, then $G[\{v,x\}]$ and $G[\{v',x'\}]$ are \textit{equivalent subgraphs}, $G[\{v,x\}]\sim G[\{v',x'\}]$.
Otherwise, they are \textit{interchangeable} but \textit{inequivalent subgraphs}.
\begin{align*}
&&
\diagram{
  % labels
  \node[draw,circle,inner sep=5pt] (w) at (0,0) {$\bm{w}$};
  \node[draw,circle,inner sep=1pt] (v) at (-0.5,1) {$\bm{v}\phantom{'}$};
  \node[draw,circle,inner sep=1pt] (v') at (+0.5,1) {$\bm{v}'$};
  \node[draw,circle,inner sep=1pt] (x) at (-1,0.3) {$\bm{x}\phantom{'}$};
  \node[draw,circle,inner sep=1pt] (x') at (+1,0.3) {$\bm{x}'$};
  \draw[-<-] (w) to ++(-60:1);
  \draw[-<-] (w) to ++(-80:1);
  \draw[-<-] (w) to ++(-100:1);
  \draw[-<-] (w) to ++(-120:1);
  \draw[->-] (v.115) to ++(0,0.5);
  \draw[->-] (v.65)  to ++(0,0.5);
  \draw[->-] (v'.115) to ++(0,0.5);
  \draw[->-] (v'.65)  to ++(0,0.5);
  \draw[-<-] (v)  to (w);
  \draw[-<-] (v') to (w);
  \draw[-<-] (x)  to (w);
  \draw[-<-] (x') to (w);
  \draw[-<-] (v)  to (x);
  \draw[-<-] (v') to (x');
}
\end{align*}
\end{ex}


\end{document}