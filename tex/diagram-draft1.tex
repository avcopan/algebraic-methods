\documentclass[11pt,fleqn]{article}
\usepackage[cm]{fullpage}
%%AVC PACKAGES
\usepackage{avcgreek}
\usepackage{avcfonts}
\usepackage{avcmath}
\usepackage[numberby=section]{avcthm} % 
\usepackage{qcmacros}
\usepackage{goldstone}
%%MACROS FOR THIS DOCUMENT
\numberwithin{equation}{section}
\usepackage{titlesec}
\titleformat{\section}{\Large\bfseries\mathversion{bold}}{\thesection.}{5pt}{}
% remove header from TOC
\makeatletter
\renewcommand\tableofcontents{%
  \@starttoc{toc}%
}
\makeatother


%%%DOCUMENT%%%
\begin{document}

\section{Diagram notation}

\begin{ntt}
\thmtitle{Particle-hole operators in diagram notation}
In diagram notation, particle-hole operators are written as oriented lines extending from a vertex.
Particle annihilation operators enter the vertex from below, particle creation operators leave the vertex extending upward, and single-excitation operators have both creation and annihilation lines.
Contractions of are represented by joining particle-hole lines with compatible position and orientation.
\begin{align*}
&&
\diagram{
  \node[dot=white,label=above:$p$] (p) at (0,0) {};
  \draw[-<-] (p) to ++(0,-0.5);
}
\equiv
  a_p
&&
\diagram{
  \node[dot=white,label=below:$p$] (p) at (0,0) {};
  \draw[->-] (p) to ++(0,+0.5);
}
\equiv
  a_p^\dagger
&&
\diagram{
  \node[dot=white] (a) at (0,0) {};
  \draw[->-] (a) to ++(0,+0.5) node[above] {$p$};
  \draw[-<-] (a) to ++(0,-0.5) node[below] {$q$};
}
\equiv
  a_p\dg a_q
&&
\diagram{
  \node[dot=white,label=above:$p$] (p) at (0,+0.5) {};
  \node[dot=white,label=below:$q$] (q) at (0,-0.5) {};
  \draw[->-] (q) to (p);
}
\equiv
  \ctr{}{a}{_p}{a} a_p a_q\dg
=
  \d_{pq}
\end{align*}
Note that the vanishing contractions are not expressible in diagram notation.
This has the advantage of simplifying the evaluation of Wick expansions without any loss of generality.
\end{ntt}

\begin{rmk}
\thmtitle{Spin-orbital labels in diagram notation}
When using generic placeholder indices, the spin-orbital labels are dispensed with wherever possible.
The removal of placeholder indices supports the primary objective of diagram notation:
stripping an expression of all extraneous details to reveal its essential information content.
\begin{align*}
&&
\diagram{
  \node[dot=white] (p) at (0,0) {};
  \draw[-<-] (p) to ++(0,-0.5);
}
\mapsto
  a_p
&&
\diagram{
  \node[dot=white] (p) at (0,0) {};
  \draw[->-] (p) to ++(0,+0.5);
}
\mapsto
  a_p^\dagger
&&
\diagram{
  \node[dot=white] (a) at (0,0) {};
  \draw[->-] (a) to ++(0,+0.5);
  \draw[-<-] (a) to ++(0,-0.5);
}
\mapsto
  a_p\dg a_q
&&
\diagram{
  \node[dot=white] (p) at (0,+0.5) {};
  \node[dot=white] (q) at (0,-0.5) {};
  \draw[->-] (q) to (p);
}
\mapsto
  \ctr{}{a}{_p}{a} a_p a_q\dg
\end{align*}
\end{rmk}

\begin{ntt}
\thmtitle{Quasiparticle-quasihole operators in diagram notation}
Diagram notation with respect to $\F$ is expressed in the quasiparticle operator basis, which is indicated by the use of closed- rather than open-circle vertices.
For particles, annihilation operators enter the vertex from below while creation operators leave the vertex extending upward.
For holes, annihilation operators leave the vertex extending downward while creation operators enter from above.
\begin{align*}
&&
\diagram{
  \node[dot] (a) at (0,0) {};
  \draw[-<-] (a) to ++(0,-0.5);
}
\mapsto
  b_a
&&
\diagram{
  \node[dot] (a) at (0,0) {};
  \draw[->-] (a) to ++(0,+0.5);
}
\mapsto
  b_a^\dagger
&&
\diagram{
  \node[dot] (i) at (0,0) {};
  \draw[->-] (i) to ++(0,-0.5);
}
\mapsto
  b_i
&&
\diagram{
  \node[dot] (i) at (0,0) {};
  \draw[-<-] (i) to ++(0,+0.5);
}
\mapsto
  b_i^\dagger
\end{align*}
That is, the hole operator diagrams are rotated by $180^\circ$.
In this basis, there are two possible contractions
\begin{align*}
&&
\diagram{
  \node[dot] (a) at (0,+0.5) {};
  \node[dot] (b) at (0,-0.5) {};
  \draw[->-] (b) to (a);
}
\mapsto
  \ctr{}{b}{_a}{b}  b_ab_b\dg
&&
\diagram{
  \node[dot] (i) at (0,+0.5) {};
  \node[dot] (j) at (0,-0.5) {};
  \draw[-<-] (j) to (i);
}
\mapsto
  \ctr{}{b}{_i}{b}  b_ib_j\dg
\end{align*}
and the single-excitation operator $a_p\dg a_q$ splits into four distinct parts.
\begin{align*}
&&
\diagram{
  \node[dot] (ab) at (0,0) {};
  \draw[->-] (ab) to ++(0,+0.5);
  \draw[-<-] (ab) to ++(0,-0.5);
}
\mapsto
  b_a\dg b_b
=
  a_a\dg a_b
&&
\diagram{
  \node[dot] (ai) at (0,0) {};
  \draw[->-] (ai) to ++(-0.25,+0.5);
  \draw[-<-] (ai) to ++(+0.25,+0.5);
}
\mapsto
  b_a\dg b_i\dg
=
  a_a\dg a_i
&&
\diagram{
  \node[dot] (ia) at (0,0) {};
  \draw[->-] (ia) to ++(-0.25,-0.5);
  \draw[-<-] (ia) to ++(+0.25,-0.5);
}
\mapsto
  b_ib_a
=
  a_i\dg a_a
&&
\diagram{
  \node[dot] (ij) at (0,0) {};
  \draw[-<-] (ij) to ++(0,+0.5);
  \draw[->-] (ij) to ++(0,-0.5);
}
\mapsto
  b_ib_j\dg 
=
  a_i\dg a_j
\end{align*}
Double lines above and below the expression now represent $\br{\F}$ and $\kt{\F}$.
\end{ntt}

\begin{ntt}
\thmtitle{Ordering of terms in diagram notation}
The left-to-right ordering of an operator product translates into top-to-bottom ordering in a diagram.
When the operator product is acting on $\br{\vac}$ or $\kt{\vac}$, this is indicated by horizontal double lines above or below the diagram.
\begin{align*}
&&
\diagram{
  \node[draw] (t1) at (0,+0.5) {term 1};
  \node (dots) at (0,0) {\vd};
  \node[draw] (tn) at (0,-0.5) {term $n$};
  \padborder{7pt}
}
=&\
  (\text{term 1})\cd(\text{term $n$})
&
\diagram[top]{
  \node[draw] (t1) at (0,+0.5) {term 1};
  \node (dots) at (0,0) {\vd};
  \node[draw] (tn) at (0,-0.5) {term $n$};
  \padborder{5pt}
}
=&\
  \br{\vac}
  (\text{term 1})\cd(\text{term $n$})
\\[15pt]
&&
\diagram[bottom]{
  \node[draw] (t1) at (0,+0.5) {term 1};
  \node (dots) at (0,0) {\vd};
  \node[draw] (tn) at (0,-0.5) {term $n$};
  \padborder{5pt}
}
=&\
  (\text{term 1})\cd(\text{term $n$})
  \kt{\vac}
&
\diagram[top,bottom]{
  \node[draw] (t1) at (0,+0.5) {term 1};
  \node (dots) at (0,0) {\vd};
  \node[draw] (tn) at (0,-0.5) {term $n$};
  \padborder{5pt}
}
=&\
  \ip{\vac|
    (\text{term 1})\cd(\text{term $n$})
  |\vac}
\end{align*}
The same notation is used for $\br{\F}$ and $\kt{\F}$ when the reference determinant $\F$ is chosen as quasiparticle vacuum.
\end{ntt}

\begin{ex}
The \vac-normal Wick expansion of $a_pa_q\dg$ can be expressed diagram notation as follows.
\begin{align*}
&&
    a_pa_q\dg
  =
  -
    a_q\dg a_p
  +
    \ctr{}{a}{_p}{a} a_pa_q\dg
\hspace{20pt}\mapsto\hspace{20pt}
  \diagram{
    \node[dot=white] (p) at (0,+0.55) {};
    \node[dot=white] (q) at (0,-0.55) {};
    \draw[-<-] (p) to ++(0,-0.5);
    \draw[->-] (q) to ++(0,+0.5);
  }
  =
  -
  \diagram{
    \node[dot=white] (pq) at (0,0) {};
    \draw[->-] (pq) to ++(0,+0.5);
    \draw[-<-] (pq) to ++(0,-0.5);
  }
  +
  \diagram{
    \node[dot=white] (p) at (0,+0.5) {};
    \node[dot=white] (q) at (0,-0.5) {};
    \draw[->-] (q) to (p);
  }
\end{align*}
Note that, in translating this diagram expression into an algebraic expression, there is no ambiguity in how to assign spin-orbital labels: the incoming line (annihilation operator) must carry the same label in every term (here, $p$), and the outgoing line (creation operator) must carry the same label in every term (here, $q$).
\end{ex}

\begin{ntt}
\thmtitle{Diagram notation for $\vac$- and $\F$-normal-ordered excitation operators}
\vac-normal-ordered excitation operators are expressed in diagram notation as single-excitation operators connected by a line.
\begin{align*}
&&
\underset{\text{$m$ times}}{
  \underbrace{
    \diagram{
      \node[dot=white] (a1) at (0,0) {};
      \node[dot=white] (a2) at (1,0) {};
      \node (dots) at (1.75,0) {$\cdots$};
      \node[dot=white] (an) at (2.5,0) {};
      \draw (a1)--(a2)--(dots)--(an);
      \draw[->-] (a1) to ++(0,+0.5);
      \draw[->-] (a2) to ++(0,+0.5);
      \draw[->-] (an) to ++(0,+0.5);
      \draw[-<-] (a1) to ++(0,-0.5);
      \draw[-<-] (a2) to ++(0,-0.5);
      \draw[-<-] (an) to ++(0,-0.5);
    }
  }
}
\mapsto
  \no{a_{p_1}\dg a_{q_1}a_{p_2}\dg a_{q_2}\cd a_{p_m}\dg a_{q_m}}
\end{align*}
$\F$-normal-ordered excitation operators are distinguished by double-circle vertices.
\begin{align*}
&&
\underset{\text{$m$ times}}{
  \underbrace{
    \diagram{
      \node[ddot=white] (a1) at (0,0) {};
      \node[ddot=white] (a2) at (1,0) {};
      \node (dots) at (1.75,0) {$\cdots$};
      \node[ddot=white] (an) at (2.5,0) {};
      \draw (a1)--(a2)--(dots)--(an);
      \draw[->-] (a1) to ++(0,+0.5);
      \draw[->-] (a2) to ++(0,+0.5);
      \draw[->-] (an) to ++(0,+0.5);
      \draw[-<-] (a1) to ++(0,-0.5);
      \draw[-<-] (a2) to ++(0,-0.5);
      \draw[-<-] (an) to ++(0,-0.5);
    }
  }
}
\mapsto
  \gno{a_{p_1}\dg a_{q_1}a_{p_2}\dg a_{q_2}\cd a_{p_m}\dg a_{q_m}}
\end{align*}
\end{ntt}


\begin{ntt}
\thmtitle{Goldstone, Brandow, and Hugenholtz representation of operators}

\begin{align*}
&&
  V
=
  \fr{1}{m!}
  \sum_{\substack{p_1\cd p_m\\q_1\cd q_m}}
  \ip{p_1\cd p_m|\bm{\op{v}}|q_1\cd q_m}\,
  \no{a_{p_1}\dg a_{q_1}\cd a_{p_m}\dg a_{q_m}}
\end{align*}

any operator with a non-antisymmetric interaction tensor can be given in antisymmetrized form
\begin{align*}
&&&&&&
  V
=
  \tfr{1}{m!}
  v_{p_1\cd p_m}^{q_1\cd q_m}
  a^{p_1\cd p_m}_{q_1\cd q_m}
=
  \pr{\tfr{1}{m!}}^2
  \ol{v}_{p_1\cd p_m}^{q_1\cd q_m}
  a^{p_1\cd p_m}_{q_1\cd q_m}
&&
  \ol{v}_{p_1\cd p_m}^{q_1\cd q_m}
\equiv
  \sum_{\pi\in\mr{S}_m}
  \ip{p_1\cd p_m|\bm{\op{v}}|q_{\pi(1)}\cd q_{\pi(m)}}
\end{align*}

the summations and weights on the algebraic expressions for $V$ naturally arise from the general rules for diagram interpretation, which will be given below
\end{ntt}



\begin{ntt}
\thmtitle{Components of a Goldstone diagram}



\begin{align*}
&&
\hspace{25pt}
\diagram{
  \node[draw] (label) at (-0.7,0) {{\mathversion{bold}$v$}};
  \node[dot=white] (v1) at (0,0) {};
  \node[dot=white] (v2) at (1,0) {};
  \node (dots) at (1.75,0) {$\cdots$};
  \node[dot=white] (vn) at (2.5,0) {};
  \draw (label)--(v1)--(v2)--(dots)--(vn);
  \draw[->-] (v1) to ++(0,+0.5) node[above] {$p_1$};
  \draw[->-] (v2) to ++(0,+0.5) node[above] {$p_2$};
  \draw[->-] (vn) to ++(0,+0.5) node[above] {$p_m$};
  \draw[-<-] (v1) to ++(0,-0.5) node[below] {$q_1$};
  \draw[-<-] (v2) to ++(0,-0.5) node[below] {$q_2$};
  \draw[-<-] (vn) to ++(0,-0.5) node[below] {$q_m$};
}
\equiv&\
  \ip{p_1\cd p_m|\bm{\op{v}}|q_1\cd q_m}\,
  \no{a_{p_1}\dg a_{q_1}\cd a_{p_m}\dg a_{q_m}}
\end{align*}

\begin{align}
&&
\diagram{
  \node[dot=white] (p) at (0,0) {};
  \draw[-<-] (p) to ++(0,-0.5);
}
\equiv&\
  [a_p]
&
\diagram{
  \node[dot=white] (p) at (0,0) {};
  \draw[->-] (p) to ++(0,+0.5);
}
\equiv&\
  [a_p\dg]
&
\diagram{
  \node[dot=white] (a1) at (0,0) {};
  \node[dot=white] (a2) at (1,0) {};
  \node (dots) at (1.75,0) {$\cdots$};
  \node[dot=white] (an) at (2.5,0) {};
  \draw (a1)--(a2)--(dots)--(an);
  \draw[->-] (a1) to ++(0,+0.5);
  \draw[->-] (a2) to ++(0,+0.5);
  \draw[->-] (an) to ++(0,+0.5);
  \draw[-<-] (a1) to ++(0,-0.5);
  \draw[-<-] (a2) to ++(0,-0.5);
  \draw[-<-] (an) to ++(0,-0.5);
}
\equiv&\
  [a^{p_1p_2\cdots p_n}_{q_1q_2\cdots q_n}]
\\
&&&
&&
&
\diagram{
  \node[draw] (label) at (-0.7,0) {{\mathversion{bold}$v$}};
  \node[dot=white] (v1) at (0,0) {};
  \node[dot=white] (v2) at (1,0) {};
  \node (dots) at (1.75,0) {$\cdots$};
  \node[dot=white] (vn) at (2.5,0) {};
  \draw (label)--(v1)--(v2)--(dots)--(vn);
  \draw[->-] (v1) to ++(0,+0.5);
  \draw[->-] (v2) to ++(0,+0.5);
  \draw[->-] (vn) to ++(0,+0.5);
  \draw[-<-] (v1) to ++(0,-0.5);
  \draw[-<-] (v2) to ++(0,-0.5);
  \draw[-<-] (vn) to ++(0,-0.5);
}
\equiv&\
  n_{\bm{v}}
  \sum_{\text{Einstein}}
  v_{p_1p_2\cdots p_n}^{q_1q_2\cdots q_n}
  a^{p_1p_2\cdots p_n}_{q_1q_2\cdots q_n}
\end{align}


\begin{align}
&&
  \tilde{a}^{p_1p_2\cdots p_n}_{q_1q_2\cdots q_n}
\equiv
\diagram{
  \node[ddot=white] (a1) at (0,0) {};
  \node[ddot=white] (a2) at (1,0) {};
  \node (dots) at (1.75,0) {$\cdots$};
  \node[ddot=white] (an) at (2.5,0) {};
  \draw (a1)--(a2)--(dots)--(an);
  \draw[->-] (a1) to ++(0,+0.5) node[above] {$p_1$};
  \draw[->-] (a2) to ++(0,+0.5) node[above] {$p_2$};
  \draw[->-] (an) to ++(0,+0.5) node[above] {$p_n$};
  \draw[-<-] (a1) to ++(0,-0.5) node[below] {$q_1$};
  \draw[-<-] (a2) to ++(0,-0.5) node[below] {$q_2$};
  \draw[-<-] (an) to ++(0,-0.5) node[below] {$q_n$};
}
\end{align}


\end{ntt}



\begin{dfn}
\thmtitle{Adjacent}
Two lines which are incident with the same vertex are called \textit{adjacent}.
\end{dfn}

\begin{dfn}
\thmtitle{Path}
A sequence of adjacent lines is called a \textit{path}.
Each path has either two external lines, in which case it is an \textit{open path}, or none, in which case it is a \textit{closed path}.
A closed path is also known as a \textit{loop}.
\end{dfn}

\begin{dfn}
\thmtitle{Degeneracy}
weight = (degeneracy)$^{-1}$
\end{dfn}

\begin{dfn}
\thmtitle{Contraction pattern}
\end{dfn}


\subsection{Antisymmetrized Goldstone diagrams}

\begin{rmk}
Because we always include a degeneracy factor $\prod_i\fr{1}{n_i!}$, any diagram corresponds to a sum \ul{over all unique terms}.
This means that, in expanding vac-normal operators in terms of $\F$-normal ones, the expansion will always be balanced if we include only the symmetry-unique diagrams.
\end{rmk}

\begin{drv}
\thmtitle{Counting the degeneracy of a contraction pattern}
For the sake of counting the degeneracy of a contraction pattern, we can decompose the figure into subsets $\{S_1,\cd,S_m\}$ of lines which are equivalent in the diagram components -- lines which have the same orientation and are connected to the same tensor.
For each $S_i$, let $\{S_i(0),S_i(1),\cd,S_i(m)\}$ be a partition into external lines $S_i(0)$ and contraction lines $S_i(j)$, where the lines from $S_i(j)$ are contracted with the lines from $S_j(i)$ in the final diagram.
Obviously, $|S_i(j)|$ must equal $|S_j(i)|$ and unless $S_i$ and $S_j$ have compatible orientations both sets must be empty, $S_i(j)=S_j(i)=\O$.
The degeneracy of the contraction pattern is given by the number of ways of partitioning each set of equivalent lines into external lines and contraction lines times the number of ways of forming each contraction between $S_i(j)$-$S_j(i)$ pairing, which is simply $|S_i(j)|!$.
This gives
\begin{align*}
  n_{\mr{ctr}}
=&\
  \prod_{i=1}^m
  {|S_i| \choose |S_i(0)|, |S_i(1)|,\cd, |S_i(m)|}
  \times
  \prod_{i=1}^m
  \prod_{j=i+1}^m
  |S_i(j)|!
=
  \prod_{i=1}^m
  \fr{|S_i|!}{|S_i(0)|!}
  \pr{
    \prod_{j=1}^{i-1}
    \fr{1}{|S_i(j)|!}
  }
\end{align*}
where the product $\prod_{i=1}^m\prod_{j=i+1}^m$ runs over $i,j$ pairs with $i<j$ and  $\ds{{n\choose k_1,\cd,k_m}}=\dfr{n!}{k_1!\cd k_m!}$ are multinomial coefficients.
\end{drv}

\begin{thm}
\thmstatement{
Consider a connected diagram composed of antisymmetrized operators.
Then the total degeneracy of the contraction pattern is
\begin{align}
&&
  \textnormal{(diagram weight)}
=
  \pr{
    \prod_i
    \fr{1}{\textnormal{component $i$ degeneracy}}
  }
\times
  \textnormal{(contraction degeneracy)}
\end{align}
}
\thmproof{


Number of contractions $=$ number of ways of partitioning each $S_i$ into an external set and $m-1$ sets for contraction with $S_j$, $j\neq i$.
}
\end{thm}


\begin{lem}
To illustrate this theorem, we can explicitly consider 
\begin{align*}
&&
\diagram{
% operator a
  \node[draw] (alabel) at (-0.7,0) {\bm{a}};
  \node[dot] (a1) at (0.0,0) {};
  \node (adots1) at (0.75,0) {\cd};
  \node[dot] (a2) at (1.5,0) {};
  \node[dot] (a3) at (2.5,0) {};
  \node (adots2) at (3.24,0) {\cd};
  \node[dot] (a4) at (4.0,0) {};
  \draw (alabel)--(a1)--(adots1)--(a2)--(a3)--(adots2)--(a4);
% operator b
  \node[dot] (b4) at (2.5,1) {};
  \node (bdots2) at (3.25,1) {\cd};
  \node[dot] (b3) at (4.0,1) {};
  \node[dot] (b2) at (5.0,1) {};
  \node (bdots1) at (5.75,1) {\cd};
  \node[dot] (b1) at (6.5,1) {};
  \node[draw] (blabel) at (7.2,1) {\bm{b}};
  \draw (blabel)--(b1)--(bdots1)--(b2)--(b3)--(bdots2)--(b4);
% lines
  \draw[->-] (a1) to ++(0,+1);
  \draw[->-] (a2) to ++(0,+1);
  \draw[->-] (a3) to     (b4);
  \draw[->-] (a4) to     (b3);
  \draw[-<-] (b2) to ++(0,-1);
  \draw[-<-] (b1) to ++(0,-1);
}
\end{align*}
Let $A$ be the set of lines leaving \bm{a} and let $B$ be the set of lines leaving \bm{b}.
Then the deneracy of this contraction pattern is.
\begin{align*}
&&
  d_{\mr{ctr}}
=
  {|A| \choose |A\cap B|}
  \cdot
  {|B| \choose |A\cap B|}
  \cdot
  |A\cap B|!
=
  \fr{|A|!|B|!}{|A\bs B|!|A\cap B|!|B\bs A|!}
\end{align*}
The degeneracies of \bm{a}, \bm{b}, and the diagram as a whole are
\begin{align}
&&
  d_{\bm{a}}
=
  |A|!
&&
  d_{\bm{b}}
=
  |B|!
&&
  d_{\mr{diag}}
=
  |A\bs B|!|A\cap B|!|B\bs A|!
\end{align}
which shows that $\dfr{d_{\mr{diag}}}{d_{\bm{a}}d_{\bm{b}}}=d_{\mr{ctr}}$.
\end{lem}


\end{document}